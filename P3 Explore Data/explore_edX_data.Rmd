Exploring edX data during 2012 to 2013 by Kan-Hua Lee
========================================================

```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# Load all of the packages that you end up using
# in your analysis in this code chunk.

require(dplyr)

# Notice that the parameter "echo" was set to FALSE for this code chunk.
# This prevents the code from displaying in the knitted HTML output.
# You should set echo=FALSE for all code chunks in your file.

library(ggplot2)
```

```{r echo=FALSE, Load_the_Data}
# Load the Data
data.path="/Users/kanhua/Documents/Big Data/edX open data 2013/"
rawfile="HMXPC13_DI_v2_5-14-14.csv"
#edxdata<-read.csv(paste(data.path,rawfile,sep=""))
#save(edxdata,file=paste(data.path,"HMXPC13_DI_v2_5-14-14.RData",sep=""))
load(paste(data.path,"HMXPC13_DI_v2_5-14-14.RData",sep=""))


# Load course details data:
course.data.path="/Users/kanhua/Dropbox/Documents in Dropbox/Open Courseware/Udacity courseware/Data Analyst Nanodegree/Udacity DA projects/P3 Explore Data/data/course_details.csv"
course.data<-read.csv(course.data.path)

# Join the edxdata and course.data
edxdata<-inner_join(x=edxdata,y=course.data,by="course_id")

# Add a column "age"
edxdata$age=2013-edxdata$YoB

# Add education levels
levels(edxdata$LoE_DI)<-c("","Less than Secondary","Secondary","Bachelor's","Master's","Doctorate")

# Add a new variable "access.days"
start.time<-strptime(edxdata$start_time_DI,"%Y-%m-%d")
last.event.time<-strptime(edxdata$last_event_DI,"%Y-%m-%d")
edxdata$access.period<-last.event.time-start.time

edxdata$access.period<-as.numeric(edxdata$access.period,units="days")
edxdata$access.rate<-with(edxdata,ndays_act/access.period)

edxdata$registered<-as.logical(edxdata$registered)
edxdata$explored<-as.logical(edxdata$explored)
edxdata$certified<-as.logical(edxdata$certified)
edxdata$viewed<-as.logical(edxdata$viewed)

```


# Basic information of the features
Number of rows and columns of the data
```{r,echo=FALSE}
dim(edxdata)
```

```{r,echo=FALSE,group_data_by_user}
#Summarize the course statistics of each unique users
users <- edxdata %>%
  group_by(userid_DI) %>%
  summarise(
    course_taken = n(),
    total_registered = sum(registered),
    total_explored = sum(explored),
    user.certificates = sum(certified)
  )  %>%
  # Add other personal information in the orignal table into new table "user"
  inner_join(edxdata,by = "userid_DI")

users$user.certificates = as.integer(users$user.certificates)
```
Number of unique users
```{r, echo=FALSE}
dim(users)
```
Histograms of number of certificates:
```{r,echo=FALSE}
table(users$user.certificates)
```


```{r, echo=FALSE}
# Group the statistics of each unique course by course id
courses <- edxdata %>%
  group_by(course_id) %>%
  summarise(
    joined_users = n(),
    passed_num = sum(certified),
    explored_num = sum(explored),
    registered_num = sum(registered),
    total_nforum_posts = sum(nforum_posts)
  ) %>%
  inner_join(course.data,by = "course_id")

courses$pass.rate <- courses$passed_num / courses$registered_num

#The ratio between explored users and registered users
courses$hangon.rate <- courses$passed_num / courses$explored_num
```


```{r,echo=FALSE}
# Summarize the statistics of each unique course by each course. Essentially we merged the courses with the same course name
course.stat <- edxdata %>%
  group_by(course_code) %>%
  summarise(t_certified = sum(certified),
  t_viewed = sum(viewed),
  t_explored = sum(explored),
  t_registered = sum(registered)
)
```

# Univariate Plots Section

##### Registered users of each course

```{r,echo=FALSE}
ggplot(aes(y = passed_num,x = course_id),data = courses) +
  geom_bar(stat = "identity") + coord_flip()
```

##### Certified users of each course

```{r,echo=FALSE,warning=FALSE}
ggplot(aes(y = certified_num,x = course_id),data = courses) +
  geom_bar(stat = "identity")
```

##### ```pass.rate``` of each course
```{r,echo=FALSE,warning=FALSE}
ggplot(aes(x=course_id,y=pass.rate),data=courses)+geom_bar(stat="identity")+coord_flip()
```

##### Histogram of ```age``` among registered users
```{r,echo=FALSE,warning=FALSE}
ggplot(aes(age),data = subset(users,users$age > 0)) + geom_bar(binwidth =
                                                                 5)
```

##### plot the histogram of all users vs. LOE_DI, with NA and blank ("") filtered.
```{r,echo=FALSE,warning=FALSE}
ggplot(aes(LoE_DI),data=filter(users,((LoE_DI!="") & (!is.nan(LoE_DI)))))+geom_bar()
```

##### Histogram of ```gender``` among registered users
```{r,echo=FALSE,warning=FALSE}
ggplot(aes(gender),data=users)+geom_bar()
```

##### Plot the distribution of nevents
```{r,echo=FALSE,warning=FALSE}
ggplot(aes(nevents),data = filter(edxdata,!is.na(nevents))) + geom_freqpoly(aes(y =
                                                                                  ..density..,color = course_code)) + xlim(0,1000)
```


```{r,echo=FALSE,warning=FALSE}
ggplot(aes(course_id,fill = gender),data = filter(edxdata,certified == 1)) +
  geom_bar() + coord_flip()

```

```{r,echo=FALSE,warning=FALSE}
ggplot(aes(short_title,fill = LoE_DI),data = filter(edxdata,certified == 1)) +
  geom_bar() + coord_flip()
```

```{r,echo=FALSE,warning=FALSE}
ggplot(aes(x=total_nforum_posts,y=hangon.rate,color=short_title),data=courses)+geom_point()
```

Histogram of ```access.rate``` that ```certified==0```
```{r,echo=FALSE,warning=FALSE}
ggplot(aes(access.rate),data=filter(edxdata,access.rate<1 &access.rate>0 &certified==0))+geom_histogram()
```

Histogram of ```access.rate``` that ```certified==1```
```{r,echo=FALSE,warning=FALSE}
ggplot(aes(access.rate),data=filter(edxdata,access.rate<1 &access.rate>0 & certified==1))+geom_histogram()
```



# Univariate Analysis

### What is the structure of your dataset?

This data has *** column and *** rows. Each row is the data for a user taking a course.

### What is/are the main feature(s) of interest in your dataset?

We mainly interested in the backgrounds and involvement of the students that attended and earned certification of each course. The features in this data set that we will focus on are: ```registered```, ```certified```, ```LoE_DI```, ```YoB```, ```gender```, ```nevents``` and ```ndays_act```.

### What other features in the dataset do you think will help support your investigation into your feature(s) of interest?


### Did you create any new variables from existing variables in the dataset?

The following new variables are created in the original dataframe ```edxdata```:

  + ```age```: the age of the user when taking the course. It is calculated by 2013-```YOB```.
  + ```access.period```: Day difference between ```last_event_DI``` and ```start_time_DI```.
  + ```access.rate```: ```ndays_act``` divided by ```access.period```. This variable essentially measures the how often a users accesses the course.

Also, we grouped the raw data by the following a number of features and created new variables for each data set for each new data sets:

##### users

The data frame grouped and summarised the data by each user.

  + ```course_taken```: number of courses viewed.
  + ```total_registered```: number of courses registered.
  + ```total_explored```: number of courses explored.
  + ```user.certificates```: number of courses certified.

##### course_id

We grouped and summarised the data by ```course_id```.
The following new variables are created:

  + ```passed_num```: total certified users of the course.
  + ```explored_num```: total users who explored the course.
  + ```registered_num```: total users who registered the course.
  + ```total_nforum_posts```: total number of posts in the course forum.
  + ```pass.rate``` : the number of certificated users divided by the number of registered users
  + ``` hangon.rate``` : the number of explored users divided by the number of registered users

##### course

Some of the course was offered more than one times durin 2012 and 2013. Therefore, another data frame is generated by grouping and summaring the raw data by ```course_code```.

  + ```t_certified```: number of total certified users.
  + ```t_viewed```: number of users who viewed the course.
  + ```t_explored```: number of users who explored the course.
  + ```t_registered```: number fo users who registered the course.


### Of the features you investigated, were there any unusual distributions? Did you perform any operations on the data to tidy, adjust, or change the form of the data? If so, why did you do this?

A few preprocessings of the raw data were performed, as listed below

+ Transform the feature ```LoE_DI``` into levels.
+ Transform the features ```certified```, ```explored``` and ```viewed``` into logical type.


# Bivariate Plots Section
```{r echo=FALSE, Bivariate_Plots}

```

Histogram of certified users by ```LoE_DI```
```{r,echo=FALSE,warning=FALSE}
ggplot(aes(user.certificates,fill=LoE_DI),data=filter(users,((LoE_DI!="") & (!is.nan(LoE_DI)))))+
  geom_bar()+
  scale_x_discrete()+
  scale_y_log10()
```

Histogram of certified users by ```gender```
```{r,echo=FALSE,warning=FALSE}
ggplot(aes(user.certificates,fill=gender),data=subset(users,!is.na(users$gender)))+geom_bar()+scale_x_discrete()+scale_y_log10()
```

Distrubution of nevents of certified users only
```{r,echo=FALSE,warning=FALSE}
ggplot(aes(nevents),data=filter(edxdata,certified==1))+geom_freqpoly(aes(y=..density..,color=course_code))+xlim(0,30000)
```

Boxplot of ```nevents``` against course
```{r,echo=FALSE,warning=FALSE}
ggplot(aes(x=course_code,y=nevents),data=filter(edxdata,certified==1))+geom_jitter(alpha=0.2)+ylim(0,30000)+geom_boxplot()+coord_flip()
```

Boxplot of ```ndays_act``` against course
```{r,echo=FALSE,warning=FALSE}
ggplot(aes(x=course_code,y=ndays_act),data=filter(edxdata,certified==1))+geom_jitter(alpha=0.2)+geom_boxplot()+coord_flip()
```

Boxplot of ```access.periods``` of each course
```{r,echo=FALSE,warning=FALSE}
ggplot(aes(x=course_code,y=as.numeric(access.period,units="days")),data=filter(edxdata,certified==1))+geom_jitter(alpha=0.2)+geom_boxplot()+coord_flip()
```

Boxplot of ```access.periods``` of each course
```{r,echo=FALSE,warning=FALSE}
ggplot(
  aes(x = course_id,y = access.rate),data = filter(edxdata,certified == 1 &
  access.rate > 0 &
  access.rate < 1)
  ) + geom_jitter(alpha = 0.2) + geom_boxplot() + coord_flip() + ylim(0,1)
```


Analyze average login events of certified users
```{r,echo=FALSE,warning=FALSE}
cert.edxdata <- filter(edxdata,certified == 1,!is.na(nevents))
cert.course.stat <- cert.edxdata %>%
  group_by(course_code) %>%
  summarise(mean_nevents = mean(as.double(nevents)),
            med_nevents = median(as.double(nevents))) %>%
  semi_join(course.data,by = "course_code") #use semi_join because we only want to get one result from course.data

cert.course.stat
```

The distribution ```LoE_DI``` of certified users
```{r,echo=FALSE,warning=FALSE}
ggplot(aes(LoE_DI),data=filter(edxdata,certified==1))+geom_histogram()+facet_wrap(~course_code)
#ggplot(aes(short_title,fill=LoE_DI),data=filter(edxdata,certified==1))+geom_histogram(position="fill")
```

Distribution of ```LOE_DI``` of all users
```{r,echo=FALSE,warning=FALSE}
ggplot(aes(short_title,fill=LoE_DI),data=edxdata)+geom_histogram(position="fill")+coord_flip()
```


```ndays_act``` vs. ```nevents``` among the users who has explored more than half of the course:
```{r,echo=FALSE,warning=FALSE}
ggplot(aes(x=ndays_act,y=nevents,color=certified),data=filter(edxdata,explored==1 & !is.na(nevents) & !is.na(ndays_act)))+geom_jitter(alpha=0.5,size=1)+ylim(0,50000)
```

```access.rate``` vs. ```grade```
```{r,echo=FALSE,warning=FALSE}
ggplot(aes(x=access.rate,y=grade,color=course_id),data=filter(edxdata,explored==1))+geom_point()+xlim(0,1)

```

# Bivariate Analysis


### Talk about some of the relationships you observed in this part of the investigation. How did the feature(s) of interest vary with other features in the dataset?

### Did you observe any interesting relationships between the other features (not the main feature(s) of interest)?

### What was the strongest relationship you found?




# Multivariate Plots Section

```{r echo=FALSE, Multivariate_Plots}

```
Plot the distribution of nevents
```{r,echo=FALSE,warning=FALSE}
ggplot(aes(nevents),data=edxdata)+geom_freqpoly(aes(y=..density..,color=course_code))+xlim(0,1000)
```


Plot the distribution of nevents of certified users only
```{r,echo=FALSE,warning=FALSE}
ggplot(aes(nevents),data=filter(edxdata,certified==1))+geom_freqpoly(aes(y=..density..,color=course_code))+xlim(0,30000)
```

Plot the distribution of ```access.rate``` of certified users:
```{r,echo=FALSE,warning=FALSE}
ggplot(aes(access.rate),data=filter(edxdata,certified==1))+geom_freqpoly(aes(y=..density..,color=course_code))+xlim(0,1)
```








# Multivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. Were there features that strengthened each other in terms of looking at your feature(s) of interest?

### Were there any interesting or surprising interactions between features?

### OPTIONAL: Did you create any models with your dataset? Discuss the strengths and limitations of your model.

------

# Final Plots and Summary

### Plot One
```{r echo=FALSE, Plot_One}

```

### Description One


### Plot Two
```{r echo=FALSE, Plot_Two}

```

### Description Two


### Plot Three
```{r echo=FALSE, Plot_Three}

```

### Description Three

------

# Reflection
